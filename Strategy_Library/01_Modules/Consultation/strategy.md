# 情感咨询模块 策略文档 (Strategy)

## 1. 模块定位
*   **角色**：万能兜底 / 开放式辅导
*   **核心目标**：解答用户对现状、行动或情感的任何疑惑（课后提问）
*   **输入**：用户的自由文本 Query
*   **输出**：针对性的回复（解答/安抚/引导/拒绝）

## 2. 系统架构

情感咨询采用 **"意图分类 + 分策略响应"** 的两层架构：

```
用户 Query
    │
    ▼
┌─────────────────┐
│  意图分类器      │  ← intent_classification/
│  (Intent Router) │
└─────────────────┘
    │
    ├──→ 防护类 ────────→ protection/
    │
    ├──→ 路由类 ────────→ routing/          ──┐
    │                                         │
    ├──→ 求解答 ────────→ seek_answer/       ├─→ 可调用其他模块
    │                                         │
    ├──→ 求陪伴 ────────→ seek_support/     ──┘
    │
    └──→ 意图不明 ──────→ unclear_intent/
```

### 模块调用能力 (Module Invocation)

**路由类、求解答、求陪伴** 三个策略在回复用户时，可能触发对其他模块的更新。

| 说明 | 内容 |
|:---|:---|
| **触发条件** | 咨询回复内容与当前行动指南/现状分析存在冲突或需要更新 |
| **可调用模块** | 现状分析、行动指南 |
| **调用方式** | *待整体设计* |

**典型场景**：
- 行动指南任务是"表白"，用户说Crush最近忙，咨询建议换时机 → 触发行动指南更新
- 用户透露新信息（如Crush有男朋友了），导致现状判断改变 → 触发现状分析更新

---

## 3. Query 分类框架 (MECE)

### 第一层：处置方式

| 大类 | 定义 | 处置方式 |
|:---|:---|:---|
| **1. 防护类** | 不应回答的问题 | 拦截/回绝 |
| **2. 路由类** | 其他模块更擅长的问题 | 简答 + 引导去对应模块 |
| **3. 咨询类** | 咨询模块的本职问题 | 独立完成回答 |

### 第二层：细分类型

#### 1. 防护类
| 子类 | 典型示例 |
|:---|:---|
| 1.1 系统攻击 | 套提示词、越狱指令 |
| 1.2 业务无关 | 写代码、查天气、闲聊 |
| 1.3 违规敏感 | 涉及骚扰/违法/伤害 |

#### 2. 路由类
| 子类 | 路由目标 |
|:---|:---|
| 2.1 诊断需求 | → 现状分析模块 |
| 2.2 规划需求 | → 行动指南模块 |
| 2.3 话术需求 | → 聊天分析模块 |

#### 3. 咨询类
| 子类 | 定义 |
|:---|:---|
| 3.0 意图不明 | 无法判断用户目的 |
| 3.1 求解答 | 有问题想要答案 |
| 3.2 求陪伴 | 有情绪想被理解 |

---

## 4. 文件结构

```
Consultation/
├── strategy.md                    # 本文件：整体架构
│
├── intent_classification/         # 意图分类
│   ├── strategy.md
│   └── prompt.md
│
├── protection/                    # 防护类
│   ├── strategy.md
│   └── prompt.md
│
├── routing/                       # 路由类
│   ├── strategy.md
│   └── prompt.md
│
├── seek_answer/                   # 求解答
│   ├── strategy.md
│   └── prompt.md
│
├── seek_support/                  # 求陪伴
│   ├── strategy.md
│   └── prompt.md
│
└── unclear_intent/                # 意图不明
    ├── strategy.md
    └── prompt.md
```

## 5. 待解决问题 / 优化方向 (Issues & Todo)
*   [ ] 各策略的 Prompt 测试与迭代
*   [ ] 意图分类的准确率验证
*   [ ] 边界Case收集与处理规则完善
*   [ ] 模块调用机制的整体设计
